#!/bin/bash

songFile=$1

periodFile=$2

rFile=$3

rTotal=$( cat $rFile | tr -d '-' | awk '{T+=$0} END { printf "%.2f\n", T }' )

start=1
end=$(cat "$rFile" | wc -l)

for i in $(seq $start $end); do
    rNumbers=$(cat $rFile | tr -d '-' | sed "${i}q;d" )
    test="$test$(echo "$rNumbers/$rTotal" | bc -l )\n"
done        

##############################   Var 'test' stores all the modified weight values

for j in $(seq $start $end); do
    songNumber=$(cat $songFile | sed "${j}q;d" )
    periodNumber=$(cat $periodFile | sed "${j}q;d" )
    
    ratio=$ratio\n$(echo "$songNumber/$periodNumber" | bc -l )

done


############################  Var 'ratio' stores all values of the equation for 'a/b'

ratioEcho=$(echo $ratio | tr 'n' '\n' | grep .)

for k in $(seq $start $end); do

    lineisolate=$( echo "$ratioEcho" | sed -n "${k}p")
    negate=$(echo '-')
    subtractor=$(echo "$lineisolate-1" | bc -l | tr -d '-' ) 
    negAbsValue=$(echo "${negate}$subtractor")
    addOne=$(echo "$negAbsValue+1" | bc -l)
    ratio=$addOne
    underonefirst="$underonefirst$(echo $ratio)\n"
    
done

underone=$(printf "$underonefirst" | grep .)

#############     Var 'underone' stores all values of 'a/b' passed to the absolute value function. (Stores all outputs of the abs value function)

for h in $(seq $start $end); do
    ratioline=$(printf "$underone" | sed "${h}q;d")
    weightline=$(printf "$test" | sed "${h}q;d")
    multiplied="$multiplied$(echo "$ratioline*$weightline" | bc -l)\n"

done


###############    Above 'for' loop multiplies all coefficients with their corresponding ratio


result=$(printf "$multiplied" | tr '\n' '+' | awk '{print $0"0"}' | bc -l)
echo "Percent correlation:     $result"